<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>District Barriers Assessment - CoSea Teachers Portal</title>
    <link rel="icon" href="{{ url_for('static', filename='Gsulogo.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styling.css') }}">
    <style>
        .barriers-container {
            max-width: 800px;
            margin: 100px auto;
            padding: 40px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .barriers-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .barriers-header h2 {
            color: #0039a6;
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .barriers-header p {
            color: #555;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .progress-indicator {
            text-align: center;
            margin-bottom: 30px;
            color: #666;
            font-size: 14px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin-bottom: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #0039a6;
            width: 66%;
            transition: width 0.3s ease;
        }
        
        .info-box {
            background: #e3f2fd;
            padding: 20px;
            border-left: 4px solid #2196F3;
            margin-bottom: 30px;
            border-radius: 4px;
        }
        
        .info-box p {
            margin: 0;
            color: #1565C0;
            font-size: 15px;
            line-height: 1.6;
        }
        
        .barriers-section {
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .barriers-section label {
            display: block;
            font-weight: 600;
            font-size: 18px;
            color: #333;
            margin-bottom: 20px;
        }
        
        .barrier-item {
            margin: 12px 0;
            padding: 15px;
            background: white;
            border-radius: 5px;
            transition: background-color 0.2s ease;
            border: 2px solid transparent;
        }
        
        .barrier-item:hover {
            background-color: #f0f7ff;
            border-color: #e3f2fd;
        }
        
        .barrier-item input[type="checkbox"] {
            margin-right: 12px;
            cursor: pointer;
            width: 20px;
            height: 20px;
            accent-color: #0039a6;
        }
        
        .barrier-item label {
            cursor: pointer;
            font-size: 16px;
            color: #333;
            font-weight: normal;
            margin: 0;
            display: inline;
        }
        
        .barrier-item.none-option {
            background: #fff3cd;
            border-color: #ffc107;
        }
        
        .barrier-item.other-option {
            background: #e8f5e9;
        }
        
        #other-text {
            width: 100%;
            padding: 12px 15px;
            margin-top: 10px;
            margin-bottom: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-family: 'Lato', sans-serif;
            font-size: 16px;
            resize: vertical;
            min-height: 80px;
            display: none;
        }
        
        #other-text:focus {
            outline: none;
            border-color: #0039a6;
        }
        
        .error-message {
            color: #dc3545;
            padding: 15px;
            margin: 15px 0;
            background-color: #f8d7da;
            border-radius: 5px;
            border-left: 4px solid #dc3545;
            font-size: 14px;
            display: none;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .btn-back, #submit {
            height: 48px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            font-family: 'Lato', sans-serif;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-sizing: border-box;
            margin: 0;
            vertical-align: middle;
        }
        
        .btn-back {
            flex: 1;
            background: #0039a6;
            color: white;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-back:hover {
            background: #0050d4;
            transform: translateY(-2px);
            text-decoration: none;
        }
        
        .btn-back:active {
            transform: translateY(0);
        }
        
        #submit {
            flex: 2;
            background-color: #0039a6;
            color: white;
        }
        
        #submit:hover {
            background-color: #0050d4;
            transform: translateY(-2px);
        }
        
        #submit:active {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>CoSea Teachers Portal</h1>
    </div>

    <div class="barriers-container">
        <div class="barriers-header">
            <h2>District Barriers Assessment</h2>
            <p><strong>School:</strong> {{ selected_school }}<br>
            <strong>District:</strong> {{ selected_district }}</p>
        </div>
        
        <div class="progress-indicator">
            <div class="progress-bar">
                <div class="progress-fill"></div>
            </div>
            Step 2 of 3: District Barriers
        </div>
        
        <div class="info-box">
            <p><strong>üìù Instructions:</strong> We would like to understand why some students at your school (or school district if you're an admin) may not be enrolling in Computer Science classes if offered. With this in mind, please select from the limiting factors below that may contribute to students not participating in Computer Science classes.</p>
        </div>
        
        <div id="error-message" class="error-message"></div>
        
        <form action="{{ url_for('district_barriers') }}" method="POST" id="barriers-form">
            <div class="barriers-section">
                <label>Select all limiting factors that apply to your school or school district:</label>
                
                <div class="barrier-item">
                    <input type="checkbox" name="barriers" value="student_demographics" id="barrier-demo">
                    <label for="barrier-demo"><strong>Student Demographics:</strong> Underrepresented groups (race/ethnicity, gender, etc.) often have less exposure to CS education</label>
                </div>
                
                <div class="barrier-item">
                    <input type="checkbox" name="barriers" value="economic_barriers" id="barrier-econ">
                    <label for="barrier-econ"><strong>Economic Barriers:</strong> Many students face financial hardship, limiting their ability to access CS resources and programs</label>
                </div>
                
                <div class="barrier-item">
                    <input type="checkbox" name="barriers" value="language_barriers" id="barrier-lang">
                    <label for="barrier-lang"><strong>Language Barriers:</strong> Students in households where English is not the primary language may struggle with CS coursework</label>
                </div>
                
                <div class="barrier-item">
                    <input type="checkbox" name="barriers" value="parent_education" id="barrier-parent">
                    <label for="barrier-parent"><strong>Parental Education Level:</strong> Students with limited exposure to CS at home may have less encouragement or understanding of CS opportunities</label>
                </div>
                
                <div class="barrier-item">
                    <input type="checkbox" name="barriers" value="no_computer_home" id="barrier-computer">
                    <label for="barrier-computer"><strong>Limited or No Computer at Home:</strong> Some students lack access to a personal computer, making it harder to practice CS skills outside school</label>
                </div>
                
                <div class="barrier-item">
                    <input type="checkbox" name="barriers" value="no_internet_home" id="barrier-internet">
                    <label for="barrier-internet"><strong>Limited or No Reliable Internet Access:</strong> Without a stable internet connection, students may struggle with online CS resources and coursework</label>
                </div>
                
                <div class="barrier-item">
                    <input type="checkbox" name="barriers" value="distance_issues" id="barrier-distance">
                    <label for="barrier-distance"><strong>Distance Challenges:</strong> A long commute or lack of transportation may prevent students from attending CS programs or extracurricular activities</label>
                </div>
                
                <div class="barrier-item">
                    <input type="checkbox" name="barriers" value="lack_cs_intro_courses" id="barrier-intro">
                    <label for="barrier-intro"><strong>No or Limited Introductory CS Courses:</strong> Some schools do not offer foundational CS courses, preventing early exposure to the field</label>
                </div>
                
                <div class="barrier-item">
                    <input type="checkbox" name="barriers" value="lack_cs_advanced_courses" id="barrier-advanced">
                    <label for="barrier-advanced"><strong>No or Limited Advanced CS Courses:</strong> Schools may lack advanced CS coursework, restricting students' ability to deepen their knowledge</label>
                </div>
                
                <div class="barrier-item other-option">
                    <input type="checkbox" name="barriers" value="other" id="barrier-other">
                    <label for="barrier-other"><strong>Other Contributing Factors:</strong> Please specify additional reasons that impact CS education access in your area</label>
                </div>
                
                <textarea id="other-text" name="other_specify" placeholder="Please describe other contributing factors..."></textarea>
                
                <div class="barrier-item none-option">
                    <input type="checkbox" name="barriers" value="none" id="barrier-none">
                    <label for="barrier-none"><strong>None</strong> - No barriers identified</label>
                </div>
            </div>
            
            <div class="button-group">
                <a href="{{ url_for('survey_questions') }}" class="btn-back">‚Üê Back to Survey</a>
                <button type="submit" id="submit">Continue to Map Selection ‚Üí</button>
            </div>
        </form>
    </div>

    <script>
        const noneCheckbox = document.getElementById('barrier-none');
        const otherCheckbox = document.getElementById('barrier-other');
        const otherText = document.getElementById('other-text');
        const errorMessage = document.getElementById('error-message');
        const allBarriers = document.querySelectorAll('input[name="barriers"]');
        const otherBarriers = Array.from(allBarriers).filter(cb => cb.id !== 'barrier-none');
        
        // Handle "None" checkbox - auto-deselect all others
        noneCheckbox.addEventListener('change', function() {
            if (this.checked) {
                otherBarriers.forEach(cb => {
                    cb.checked = false;
                });
                // Hide and clear "Other" text box
                otherText.style.display = 'none';
                otherText.value = '';
                errorMessage.style.display = 'none';
            }
        });
        
        // Handle any other barrier checkbox - auto-deselect "None"
        otherBarriers.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                if (this.checked && noneCheckbox.checked) {
                    noneCheckbox.checked = false;
                }
            });
        });
        
        // Handle "Other" checkbox - show/hide text box
        otherCheckbox.addEventListener('change', function() {
            if (this.checked) {
                otherText.style.display = 'block';
                otherText.focus();
            } else {
                otherText.style.display = 'none';
                otherText.value = '';
            }
        });
        
        // Form validation
        document.getElementById('barriers-form').addEventListener('submit', function(e) {
            const checkedBarriers = Array.from(allBarriers).filter(cb => cb.checked);
            
            if (checkedBarriers.length === 0) {
                e.preventDefault();
                errorMessage.textContent = '‚ö†Ô∏è Please select at least one barrier option.';
                errorMessage.style.display = 'block';
                window.scrollTo({ top: 0, behavior: 'smooth' });
                return false;
            }
            
            if (otherCheckbox.checked && !otherText.value.trim()) {
                e.preventDefault();
                errorMessage.textContent = '‚ö†Ô∏è Please specify the "Other Contributing Factors" in the text area.';
                errorMessage.style.display = 'block';
                otherText.focus();
                return false;
            }
            
            errorMessage.style.display = 'none';
        });
        
        // Pre-fill form if data exists
        document.addEventListener('DOMContentLoaded', function() {
            const savedBarriersRaw = '{{ saved_barriers | tojson | safe }}';
            const savedOtherRaw = '{{ saved_other if saved_other else "" }}';
            
            let savedBarriers = [];
            try {
                if (savedBarriersRaw && savedBarriersRaw !== 'null' && savedBarriersRaw !== '[]') {
                    savedBarriers = JSON.parse(savedBarriersRaw);
                }
            } catch (e) {
                console.error('Error parsing saved barriers:', e);
            }
            
            if (savedBarriers && savedBarriers.length > 0) {
                savedBarriers.forEach(barrier => {
                    const barrierMap = {
                        'none': 'barrier-none',
                        'student_demographics': 'barrier-demo',
                        'economic_barriers': 'barrier-econ',
                        'language_barriers': 'barrier-lang',
                        'parent_education': 'barrier-parent',
                        'no_computer_home': 'barrier-computer',
                        'no_internet_home': 'barrier-internet',
                        'distance_issues': 'barrier-distance',
                        'lack_cs_intro_courses': 'barrier-intro',
                        'lack_cs_advanced_courses': 'barrier-advanced',
                        'other': 'barrier-other'
                    };
                    
                    const checkboxId = barrierMap[barrier];
                    const checkbox = document.getElementById(checkboxId);
                    
                    if (checkbox) {
                        checkbox.checked = true;
                        
                        if (barrier === 'other') {
                            otherText.style.display = 'block';
                        }
                    }
                });
            }
            
            if (savedOtherRaw && savedOtherRaw !== "" && savedOtherRaw !== "None") {
                otherText.value = savedOtherRaw;
                if (otherCheckbox.checked) {
                    otherText.style.display = 'block';
                }
            }
        });
    </script>
</body>
</html>